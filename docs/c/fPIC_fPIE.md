# 위치 독립 코드(PIC; Position Independent Code)
프로그램 수정 없이 어떤 주소에서든 실행이 가능한 재배치가 필요 없는 코드이다.
non-PIC 공유 라이브러리를 작설 할 때 사용한다.
 <br>

PIC를 사용하지 않을 경우 다음의 단점이 발생한다.
1. 다른 프로세스와 코드(.text) 공유가 불가능하다.
3. 실행 시 코드 재배치를 위한 시간이 필요하다.
4. 코드(.text) 정보는 작지만, <br> 코드 재배치를 위한 정보(.rel.dyn)는 많은 용량을 차지한다.


따라서,  **공유 라이브러리를 작성할 때는 PIC로 컴파일하도록 한다.**
```
$ gcc -shared -fPIC -o fpic-pic.so fpic.c
```

 <br>

# 위치 독립 실행 파일(PIE; Position Independent Executable)
전체가 PIC로 이루어진 실행 가능한 바이너리이다.

**ASLR(Address Space Layout Randomization)** 은 리눅스에서 사용하는 메모리 보호기법이다.
주소를 매번 실행할 때마다 무작위화시켜 공격을 방해하는데 `스택, 힙, 라이브러리 영역을 포함한 데이터 영역`에 대해서만 주소를 변경시킨다.

**PIE(Position Independent Executable)** 는 `바이너리 영역`까지의 주소를 무작위화 시켜서 공격을 방해하기 위한 기법이다.
PIE를 사용하면 main의 주소까지 상대 주소로 변경하여 공격자가 실행 가능한 코드가 어디에 존재하는지 알 수 없게 방해할 수 있다.

```
$ gcc -fPIE -pie -o fpie-pie fpie.c
```


# 비교
| 구분    | 메모리 주소      | 재배치                                   | 대상            |
| ------- | ---------------- | ---------------------------------------- | --------------- |
| non-PIC | 절대 주소        | 프로그램 실행 시 재배치                  |                 |
| PIC     | 상대 주소 (부분) | 프로그램 실행 전 링커 또는 로드가 재배치 | 공유 라이브러리 |
| PIE     | 상대 주소 (전체) | 프로그램 실행 전 링커 또는 로드가 재배치 | 실행 파일       |


# 참고
- https://devanix.tistory.com/198
